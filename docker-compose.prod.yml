version: "3.7"
services:
  server:
    environment:
      - MODE=production
  filebeat:
    build: ./filebeat
    container_name: filebeat
    env_file: beat.env
    volumes:
      - type: volume
        source: log_volume
        target: /log_volume
    depends_on:
      - server
    network_mode: "host"
    command:
      [
        "./wait-for-it.sh",
        "127.0.0.1:8081",
        "--",
        "filebeat",
        "-environment",
        "container",
      ]
